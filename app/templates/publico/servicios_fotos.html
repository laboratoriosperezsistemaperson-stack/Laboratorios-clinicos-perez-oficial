{% extends "base.html" %}
{% block title %}Fotos - Laboratorio Pérez{% endblock %}
{% block content %}
<style>
    :root {
        --fb-green: #1ABC9C;
        --fb-orange: #F39C12;
        --fb-dark: #1c1e21;
        --fb-gray: #65676b;
        --fb-light: #f0f2f5;
        --fb-card: #ffffff;
        --fb-border: #dadde1;
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    html,
    body {
        overflow-x: hidden;
        width: 100%;
        max-width: 100vw;
    }

    body {
        background: var(--fb-light);
        font-family: 'Segoe UI', system-ui, sans-serif;
    }

    /* COVER - ESTILO FACEBOOK */
    .fb-cover {
        width: 100%;
        height: 420px;
        position: relative;
        overflow: hidden;
        background: #f0f2f5;
    }

    .fb-cover img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        object-position: center 20%;
    }

    /* Ajuste para pantallas grandes - mostrar más de la imagen */
    @media (min-width: 1200px) {
        .fb-cover {
            height: 450px;
        }

        .fb-cover img {
            object-position: center 18%;
        }
    }

    @media (max-width: 768px) {
        .fb-cover {
            height: 350px;
        }

        .fb-cover img {
            object-position: center 25%;
        }
    }

    .fb-cover::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 100px;
        background: linear-gradient(to top, var(--fb-card) 0%, transparent 100%);
    }

    .fb-header {
        background: var(--fb-card);
        border-bottom: 1px solid var(--fb-border);
    }

    .fb-header-content {
        max-width: 1000px;
        margin: 0 auto;
        padding: 0 25px;
        margin-top: -80px;
        position: relative;
        z-index: 10;
    }

    .fb-profile-row {
        display: flex;
        align-items: flex-end;
        gap: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid var(--fb-border);
    }

    .fb-avatar {
        width: 160px;
        height: 160px;
        border-radius: 50%;
        border: 5px solid var(--fb-card);
        overflow: hidden;
        background: var(--fb-card);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        flex-shrink: 0;
    }

    .fb-avatar img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .fb-info {
        flex: 1;
        padding-bottom: 10px;
    }

    .fb-name {
        font-size: 2rem;
        font-weight: 900;
        color: var(--fb-dark);
        margin-bottom: 8px;
    }

    .fb-name span {
        color: var(--fb-green);
    }

    .fb-meta {
        display: flex;
        gap: 20px;
        flex-wrap: wrap;
        color: var(--fb-gray);
        font-size: 0.95rem;
    }

    .fb-meta-item {
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .fb-meta-item i {
        color: var(--fb-green);
    }

    .fb-nav {
        max-width: 1000px;
        margin: 0 auto;
        padding: 0 25px;
        display: flex;
        gap: 5px;
    }

    .fb-tab {
        padding: 16px 18px;
        color: var(--fb-gray);
        text-decoration: none;
        font-weight: 600;
        font-size: 0.95rem;
        border-bottom: 3px solid transparent;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .fb-tab:hover {
        background: var(--fb-light);
        color: var(--fb-green);
    }

    .fb-tab.active {
        color: var(--fb-green);
        border-bottom-color: var(--fb-green);
    }

    .fb-main {
        max-width: 1000px;
        margin: 25px auto;
        padding: 0 25px 60px;
    }

    .photos-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
        background: var(--fb-card);
        padding: 20px 25px;
        border-radius: 12px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .photos-header h2 {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--fb-dark);
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .photos-header h2 i {
        color: var(--fb-green);
    }

    .photos-count {
        background: linear-gradient(135deg, var(--fb-green), var(--fb-orange));
        color: white;
        padding: 8px 16px;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.9rem;
    }

    .photos-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
        gap: 12px;
    }

    .photo-item {
        aspect-ratio: 1;
        border-radius: 12px;
        overflow: hidden;
        cursor: pointer;
        position: relative;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        transition: all 0.3s;
        background: var(--fb-card);
    }

    .photo-item:hover {
        transform: scale(1.03);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        z-index: 5;
    }

    .photo-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s;
    }

    .photo-item:hover img {
        transform: scale(1.1);
    }

    .photo-overlay {
        position: absolute;
        inset: 0;
        background: linear-gradient(to top, rgba(0, 0, 0, 0.8) 0%, transparent 60%);
        opacity: 0;
        transition: opacity 0.3s;
        display: flex;
        flex-direction: column;
        justify-content: flex-end;
        padding: 15px;
    }

    .photo-item:hover .photo-overlay {
        opacity: 1;
    }

    .photo-title {
        color: white;
        font-size: 0.95rem;
        font-weight: 600;
    }

    .photo-desc {
        color: rgba(255, 255, 255, 0.8);
        font-size: 0.8rem;
    }

    .photo-modal {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.95);
        z-index: 9999;
        display: none;
        align-items: center;
        justify-content: center;
        padding: 20px;
    }

    .photo-modal.active {
        display: flex;
    }

    .modal-content {
        max-width: 90vw;
        max-height: 80vh;
        position: relative;
        margin-top: 60px;
    }

    .modal-content img {
        max-width: 100%;
        max-height: 70vh;
        object-fit: contain;
        border-radius: 10px;
    }

    .modal-close {
        position: absolute;
        top: -40px;
        right: 0;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.2);
        border: none;
        color: white;
        font-size: 1.5rem;
        cursor: pointer;
    }

    .modal-title {
        text-align: center;
        color: white;
        margin-top: 15px;
        margin-bottom: 60px;
        font-size: 1.1rem;
        font-weight: 600;
    }

    .modal-nav {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.2);
        border: none;
        color: white;
        font-size: 1.5rem;
        cursor: pointer;
    }

    .modal-prev {
        left: -70px;
    }

    .modal-next {
        right: -70px;
    }

    @media (max-width: 768px) {
        .fb-cover {
            height: 350px;
        }

        .fb-header-content {
            margin-top: -60px;
            padding: 0 10px;
        }

        .fb-profile-row {
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .fb-avatar {
            width: 130px;
            height: 130px;
        }

        .fb-main {
            padding: 0 10px 60px;
        }

        .fb-nav {
            padding: 0 5px;
            gap: 2px;
        }

        .fb-tab {
            padding: 12px 8px;
            font-size: 0.8rem;
            white-space: nowrap;
        }

        .fb-name {
            font-size: 1.5rem;
        }

        .fb-meta {
            flex-direction: column;
            font-size: 0.85rem;
            gap: 5px;
            align-items: flex-start;
        }

        .photos-grid {
            grid-template-columns: repeat(2, 1fr);
            padding: 0 5px;
        }

        .modal-nav {
            width: 40px;
            height: 40px;
        }

        .modal-prev {
            left: 10px;
        }

        .modal-next {
            right: 10px;
        }
    }

    /* Close button - Desktop */
    #closeBtn {
        bottom: 30px !important;
    }

    /* Close button - Mobile */
    @media (max-width: 768px) {
        #closeBtn {
            bottom: 80px !important;
            padding: 8px 20px !important;
            font-size: 0.9rem !important;
        }
    }
</style>

<div class="fb-cover" onclick="openCoverModal()" style="cursor: pointer;" title="Clic para ver imagen completa">
    <img src="{{ url_for('static', filename='img/cerro_potosi.jpg') }}" alt="Cerro Rico" id="coverImage">
</div>
<div class="fb-header">
    <div class="fb-header-content">
        <div class="fb-profile-row">
            <div class="fb-avatar"><img src="{{ url_for('static', filename='img/logo.jpg') }}" alt="Logo"></div>
            <div class="fb-info">
                <h1 class="fb-name">Laboratorio Clínico <span>Pérez</span></h1>
                <div class="fb-meta">
                    <span class="fb-meta-item"><i class="fas fa-microscope"></i> Laboratorio Clínico</span>
                    <span class="fb-meta-item"><i class="fas fa-map-marker-alt"></i> Potosí, Bolivia</span>
                    <span class="fb-meta-item"><i class="fas fa-star"></i> 4.9 ★</span>
                </div>
            </div>
        </div>
        <nav class="fb-nav">
            <a href="{{ url_for('main.servicios') }}" class="fb-tab"><i class="fas fa-stream"></i> Publicaciones</a>
            <a href="{{ url_for('main.servicios_info') }}" class="fb-tab"><i class="fas fa-info-circle"></i>
                Información</a>
            <a href="{{ url_for('main.servicios_fotos') }}" class="fb-tab active"><i class="fas fa-images"></i>
                Fotos</a>
        </nav>
    </div>
</div>

<div class="fb-main">
    <div class="photos-header">
        <h2><i class="fas fa-images"></i> Galería de Fotos</h2>
        <span class="photos-count">{{ fotos|length if fotos else 21 }} fotos</span>
    </div>

    {% if fotos %}
    <!-- Galería dinámica desde la base de datos -->
    <div class="photos-grid">
        {% for foto in fotos %}
        <div class="photo-item" onclick="openModal({{ loop.index0 }})">
            <img src="{{ url_for('static', filename=foto.imagen) }}" alt="{{ foto.titulo }}">
            <div class="photo-overlay"><span class="photo-title">{{ foto.titulo }}</span></div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <!-- Galería estática por defecto -->
    <div class="photos-grid">
        <div class="photo-item" onclick="openModal(0)"><img
                src="{{ url_for('static', filename='img/analisis_especializados.jpg') }}" alt="">
            <div class="photo-overlay"><span class="photo-title">Análisis Especializados</span></div>
        </div>
        <div class="photo-item" onclick="openModal(1)"><img
                src="{{ url_for('static', filename='img/resultados_rapidos_maglumi.jpg') }}" alt="">
            <div class="photo-overlay"><span class="photo-title">Resultados Rápidos</span></div>
        </div>
        <div class="photo-item" onclick="openModal(2)"><img
                src="{{ url_for('static', filename='img/horario_atencion.jpg') }}" alt="">
            <div class="photo-overlay"><span class="photo-title">Horario de Atención</span></div>
        </div>
        <div class="photo-item" onclick="openModal(3)"><img
                src="{{ url_for('static', filename='img/fertilidad_antimulleriana.jpg') }}" alt="">
            <div class="photo-overlay"><span class="photo-title">Pruebas de Fertilidad</span></div>
        </div>
        <div class="photo-item" onclick="openModal(4)"><img
                src="{{ url_for('static', filename='img/pruebas_adn.jpg') }}" alt="">
            <div class="photo-overlay"><span class="photo-title">Pruebas de ADN</span></div>
        </div>
        <div class="photo-item" onclick="openModal(5)"><img
                src="{{ url_for('static', filename='img/pruebas_paternidad.jpg') }}" alt="">
            <div class="photo-overlay"><span class="photo-title">Pruebas de Paternidad</span></div>
        </div>
        <div class="photo-item" onclick="openModal(6)"><img
                src="{{ url_for('static', filename='img/pruebas_embarazo.jpg') }}" alt="">
            <div class="photo-overlay"><span class="photo-title">Pruebas de Embarazo</span></div>
        </div>
        <div class="photo-item" onclick="openModal(7)"><img
                src="{{ url_for('static', filename='img/resultados_diabeticos.jpg') }}" alt="">
            <div class="photo-overlay"><span class="photo-title">Control de Diabetes</span></div>
        </div>
    </div>
    {% endif %}
</div>

<div id="photoModal" class="photo-modal">
    <!-- Title at top -->
    <div id="modalTitle"
        style="position: absolute; top: 70px; left: 50%; transform: translateX(-50%); color: white; font-size: 1.1rem; font-weight: 600; text-align: center; background: rgba(0,0,0,0.5); padding: 10px 25px; border-radius: 25px; z-index: 10;">
    </div>

    <div class="modal-content">
        <button class="modal-close" onclick="closeModal()"><i class="fas fa-times"></i></button>
        <button class="modal-nav modal-prev" onclick="prevPhoto()"><i class="fas fa-chevron-left"></i></button>
        <img id="modalImg" src="" alt="">
        <button class="modal-nav modal-next" onclick="nextPhoto()"><i class="fas fa-chevron-right"></i></button>
    </div>

    <!-- Cerrar button at bottom -->
    <button id="closeBtn" onclick="closeModal()"
        style="position: absolute; bottom: 60px; left: 50%; transform: translateX(-50%); background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 10px 30px; border-radius: 25px; cursor: pointer; font-size: 1rem; transition: all 0.3s; z-index: 20;"
        onmouseover="this.style.background='rgba(255,255,255,0.3)'"
        onmouseout="this.style.background='rgba(255,255,255,0.15)'">
        <i class="fas fa-times-circle"></i> Cerrar
    </button>
</div>

<script>
    {% if fotos %}
    // Fotos dinámicas desde la base de datos
    const photos = [
        {% for foto in fotos %}
    { src: "{{ url_for('static', filename=foto.imagen) }}", title: "{{ foto.titulo }}" } {% if not loop.last %}, {% endif %}
    {% endfor %}
    ];
    {% else %}
    // Fotos estáticas por defecto
    const photos = [
        { src: "{{ url_for('static', filename='img/analisis_especializados.jpg') }}", title: "Análisis Especializados" },
        { src: "{{ url_for('static', filename='img/resultados_rapidos_maglumi.jpg') }}", title: "Resultados Rápidos" },
        { src: "{{ url_for('static', filename='img/horario_atencion.jpg') }}", title: "Horario de Atención" },
        { src: "{{ url_for('static', filename='img/fertilidad_antimulleriana.jpg') }}", title: "Pruebas de Fertilidad" },
        { src: "{{ url_for('static', filename='img/pruebas_adn.jpg') }}", title: "Pruebas de ADN" },
        { src: "{{ url_for('static', filename='img/pruebas_paternidad.jpg') }}", title: "Pruebas de Paternidad" },
        { src: "{{ url_for('static', filename='img/pruebas_embarazo.jpg') }}", title: "Pruebas de Embarazo" },
        { src: "{{ url_for('static', filename='img/resultados_diabeticos.jpg') }}", title: "Control de Diabetes" }
    ];
    {% endif %}

    let currentIndex = 0;
    const totalPhotos = photos.length;

    function openModal(i) {
        currentIndex = i;
        updateModal();
        document.getElementById('photoModal').classList.add('active');
        document.body.style.overflow = 'hidden';
    }

    function closeModal() {
        document.getElementById('photoModal').classList.remove('active');
        document.body.style.overflow = '';
    }

    function updateModal() {
        document.getElementById('modalImg').src = photos[currentIndex].src;
        document.getElementById('modalTitle').textContent = photos[currentIndex].title + ' (' + (currentIndex + 1) + '/' + totalPhotos + ')';
    }

    function nextPhoto() { currentIndex = (currentIndex + 1) % totalPhotos; updateModal(); }
    function prevPhoto() { currentIndex = (currentIndex - 1 + totalPhotos) % totalPhotos; updateModal(); }

    // Handle click on modal background - closes if clicking outside the image
    function handlePhotoModalClick(event) {
        // Close only if clicking directly on the modal background or the hint text
        if (event.target.id === 'photoModal' || event.target.classList.contains('modal-hint')) {
            closeModal();
        }
    }

    // Cover modal functions
    function openCoverModal() {
        const coverImg = document.getElementById('coverImage');
        document.getElementById('coverModalImg').src = coverImg.src;
        document.getElementById('coverModal').classList.add('active');
        document.body.style.overflow = 'hidden';
    }

    function closeCoverModal() {
        document.getElementById('coverModal').classList.remove('active');
        document.body.style.overflow = '';
    }

    document.addEventListener('keydown', e => {
        // Photo gallery modal
        if (document.getElementById('photoModal').classList.contains('active')) {
            if (e.key === 'Escape') closeModal();
            if (e.key === 'ArrowLeft') prevPhoto();
            if (e.key === 'ArrowRight') nextPhoto();
        }
        // Cover modal
        if (document.getElementById('coverModal').classList.contains('active')) {
            if (e.key === 'Escape') closeCoverModal();
        }
    });

    // Double-click handler for photo gallery modal background
    document.getElementById('photoModal').addEventListener('dblclick', function (e) {
        // Only close if clicking on the background (not on the content)
        if (e.target === this || e.target.classList.contains('modal-hint')) {
            closeModal();
        }
    });

    // Double-click handler for cover modal background
    document.getElementById('coverModal').addEventListener('dblclick', function (e) {
        if (e.target === this) {
            closeCoverModal();
        }
    });
</script>

<!-- Modal para ver foto de portada completa -->
<div id="coverModal" class="cover-modal" ondblclick="closeCoverModal()">
    <div class="cover-modal-content" onclick="event.stopPropagation()" ondblclick="event.stopPropagation()">
        <button class="cover-modal-close" onclick="closeCoverModal()"><i class="fas fa-times"></i></button>
        <img id="coverModalImg" src="" alt="Foto de Portada">
    </div>
    <div
        style="position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); color: rgba(255,255,255,0.5); font-size: 0.85rem;">
        <i class="fas fa-mouse-pointer"></i> Doble clic para cerrar | ESC para salir
    </div>
</div>

<style>
    .cover-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.95);
        z-index: 10000;
        justify-content: center;
        align-items: center;
    }

    .cover-modal.active {
        display: flex;
    }

    .cover-modal-content {
        position: relative;
        max-width: 95%;
        max-height: 90vh;
    }

    .cover-modal-content img {
        max-width: 100%;
        max-height: 85vh;
        border-radius: 10px;
        box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
    }

    .cover-modal-close {
        position: absolute;
        top: -40px;
        right: 0;
        background: none;
        border: none;
        color: white;
        font-size: 2rem;
        cursor: pointer;
        transition: all 0.3s;
    }

    .cover-modal-close:hover {
        transform: scale(1.2);
        color: #F39C12;
    }
</style>

<script>
    // Wait for DOM to be ready, then attach double-click listeners
    document.addEventListener('DOMContentLoaded', function () {
        // Double-click to close photo gallery modal
        var photoModal = document.getElementById('photoModal');
        if (photoModal) {
            photoModal.addEventListener('dblclick', function (e) {
                if (e.target === this) {
                    closeModal();
                }
            });
        }

        // Double-click to close cover modal
        var coverModal = document.getElementById('coverModal');
        if (coverModal) {
            coverModal.addEventListener('dblclick', function (e) {
                if (e.target === this) {
                    closeCoverModal();
                }
            });
        }
    });
</script>

{% endblock %}